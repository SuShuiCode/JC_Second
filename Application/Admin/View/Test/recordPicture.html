<include file="Common:header" title="后台首页"/>
<div id="page-wrapper">
    <include file="Common:breadcrumb" />
    <div id="page-inner" class="container">
        <!-- 主要模板 starting -->

        <div class="search-form">
            <form class="form-inline" method="GET" action="">
                <div class="form-group">
                    <label>中心编号：</label>
                    <input type="text" class="form-control input-sm" name="keyword" />
                </div>
                <button type="submit" class="btn btn-primary btn-sm" >查询</button>
            </form>
        </div>

        <table class="table table-bordered table-striped table-hover">
            <thead>
            <th width="10%">收样日期</th>
            <th>中心编号</th>
            <th>样本名称</th>
            <th>检验依据</th>
            <th width="30%">检测进度</th>
            </thead>
            <tbody>
            <volist name="lists" id="one">
                <tr>
                    <td>{$one.workdate}</td>
                    <td>{$one.centreno}</td>
                    <td>{$one.samplename}</td>
                    <td>{$one.testcreiteria}</td>
                    <td>
                        <div style="visibility:{$view}">
                            <if condition="($one[status] eq 7) AND ($one[takelist_user_id] eq $userid)">
                                <a href="{:U('/admin/test/recordPictureUp')}?id={$one.centreno}" class="btn btn-info btn-xs"><i class="glyphicon glyphicon-open"></i>检测图片上传</a>
                                <a href="{:U('/admin/test/infoShow')}?id={$one.centreno}" class="btn btn-info btn-xs"><i class="glyphicon glyphicon-search"></i>检测工作通知单</a>
                                <a class="btn btn-success btn-xs disabled">正在检测中</a>
                                <else />
                                <if condition="$one[status] eq 7">
                                    <a class="btn btn-primary btn-xs disabled">已接单</a>
                                    <else />
                                    <a href="javascript:void(0);" onclick="takeList('{$one.centreno}')" class="btn btn-primary btn-xs"><i class="glyphicon glyphicon-check"></i>接单</a>
                                </if>
                            </if>
                        </div>
                    </td>
                </tr>
            </volist>
            </tbody>
        </table>
        <div class=" pull-right"><nav aria-label="Page navigation" id="pagination">{$pagination}</nav></div>
        <!-- main end-->

    </div>
</div>
</div>
<script type="text/javascript">
    function takeList(centreno){
        if(!centreno)return false;
        var _options = {"flag":"error","text":"您确定要接单吗？","buttons":{"ok":{"action":function(){doTakeList(centreno);}},"cancel":{}}};
        doConfirmDialog(_options);
    }
    function doTakeList(centreno) {
        centreno.onclick = function() {};
        $.ajax({
            type:"post",
            url:"{:U('/admin/test/doneTakeList')}",
            data:{"centreno":centreno},
            dataType:"json",
            success:function(ret){
                if(ret.msg=='succ') {
                    window.location.reload();
                }
            }
        });
    }
</script>
<include file="Common:footer" />