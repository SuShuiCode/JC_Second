<include file="Common:header" title="后台首页"/>
<div id="page-wrapper">
    <include file="Common:breadcrumb" />
    <div id="page-inner" class="container">
        <!-- 主要模板 starting -->

        <div class="search-form">
            <form class="form-inline" method="GET" action="">
                <div class="form-group">
                    <label>中心编号：</label>
                    <input type="text" class="form-control input-sm" name="keyword" />
                    <input type="hidden" name="p" value="1" />
                </div>
                <button type="submit" class="btn btn-primary btn-sm" >查询</button>
            </form>
        </div>

        <table class="table table-bordered table-striped table-hover">
            <thead>
            <th width="5%">序号</th>
            <th width="10%">收样日期</th>
            <th width="15%">中心编号</th>
            <th>样本名称</th>
            <th>检验依据</th>
            <th width="38%">检测进度</th>
            </thead>
            <tbody>
            <volist name="lists" id="one" key="i">
                <tr>
                    <td><if condition="$_GET['p'] eq 0">{$i}
                        <else />{$_GET['p']*10-10+$i}</if></td>
                    <td>{$one.workdate}</td>
                    <td><if condition="$one[centreno1] or $one[centreno2] or $one[centreno3]">
                        <span style="color: red"><i class="glyphicon glyphicon-star"></i>{$one.centreno}</span>
                        <else />
                        <span>{$one.centreno}</span></if>
                    </td>
                    <td>{$one.samplename}</td>
                    <td>{$one.testcreiteria}</td>
                    <td>
                        <div style="visibility:{$view}">

                            <if condition="$one[takelist_user_id] eq $userid">
                                <a href="{:U('/admin/test/infoShow')}?id={$one.centreno}" class="btn btn-primary btn-xs"><i class="glyphicon glyphicon-search"></i>检测工作通知单</a>
                                <a href="{:U('/admin/test/recordPictureUp')}?id={$one.centreno}" class="btn btn-primary btn-xs"><i class="glyphicon glyphicon-upload"></i>检测图片上传</a>
                                <if condition="$one[centreno1] or $one[centreno2] or $one[centreno3]">
                                    <a href="" class="btn btn-primary btn-xs"><i class="glyphicon glyphicon-list"></i>更改单</a></if>
                                <if condition="$one[status] eq 7">
                                    <a herf="javascript:void(0);" class="btn btn-success btn-xs" onclick="allSave('{$one.centreno}')"><i class="glyphicon glyphicon-floppy-disk"></i>上传完毕</a>
                                    <span style="color: orangered">正在检测中...</span>
                                <else />
                                    <span style="color: green">检测完毕</span></if>
                                <elseif condition="($one[status] eq 0) AND ($one[takelist_user_id] eq 0)"/>
                                    <a href="{:U('/admin/test/infoShow')}?id={$one.centreno}" class="btn btn-primary btn-xs"><i class="glyphicon glyphicon-search"></i>检测工作通知单</a>
                                    <a href="javascript:void(0);" onclick="takeList('{$one.centreno}')" class="btn btn-primary btn-xs"><i class="glyphicon glyphicon-check"></i>接单</a>
                                    <else />
                                    <a class="btn btn-primary btn-xs disabled">已被接单</a>
                            </if>
                        </div>
                    </td>
                </tr>
            </volist>
            </tbody>
        </table>
        <div class=" pull-right"><nav aria-label="Page navigation" id="pagination">{$pagination}</nav></div>
        <!-- main end-->

    </div>
</div>
</div>
<script type="text/javascript">
    function takeList(centreno){
        if(!centreno)return false;
        var _options = {"flag":"error","text":"您确定要接单吗？","buttons":{"ok":{"action":function(){doTakeList(centreno);}},"cancel":{}}};
        doConfirmDialog(_options);
    }
    function doTakeList(centreno) {
        centreno.onclick = function() {};
        $.ajax({
            type:"post",
            url:"{:U('/admin/test/doneTakeList')}",
            data:{"centreno":centreno},
            dataType:"json",
            success:function(ret){
                if(ret.msg=='succ') {
                    window.location.reload();
                }
            }
        });
    }
    //上传完毕按钮
    function allSave(centreno) {
        if(!centreno) return false;
        var _options = {"flag":"error","text":"您确定已经上传完所有的记录吗？","buttons":{"ok":{"action":function(){doneAllSave(centreno);}},"cancel":{}}};
        doConfirmDialog(_options);
    }
    function doneAllSave(centreno){
        if(!centreno) return false;
        $.ajax({
            type:"post",
            url:"{:U('/admin/test/doAllSave')}",
            data:{"centreno":centreno},
            dataType:"json",
            success:function(ret){
                if(ret.msg=='succ'){
                    window.location.href="{:U('/admin/test/recordPicture')}";
                }
                else if(ret.msg=='error')
                {
                    var _options = {"text":'您没有提交任何记录!'};
                    doAlertDialog(_options);
                }
                else{
                    var _options = {"text":"Error！"};
                    doAlertDialog(_options);
                }
            }
        });
    }
</script>
<include file="Common:footer" />