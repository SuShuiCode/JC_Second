<include file="Common:header" title="后台首页"/>
<div id="page-wrapper">
    <include file="Common:breadcrumb" />
    <div id="page-inner" class="container">
        <!-- 主要模板 starting -->

        <table class="table table-bordered table-striped table-hover">
            <thead>
            <th>中心编号</th>
            <th>样本名称</th>
            <th>操作</th>
            </thead>
            <tbody>
            <volist name="lists" id="one">
                <tr>
                    <td><if condition="$one[centreno1] or $one[centreno2] or $one[centreno3]">
                        <span style="color: red"><i class="glyphicon glyphicon-star"></i>{$one.centreno}</span>
                        <else />
                        <span>{$one.centreno}</span></if></td>
                    <td>{$one.samplename}</td>
                    <td>
                        <if condition="$one[centreno1] or $one[centreno2] or $one[centreno3]">
                            <a href="{:U('/admin/contract/reWriteTest')}?id={$one.centreno}" class="btn btn-primary btn-xs">更改单</a></if>
                        <if condition="$one[sub_status]==0 or $one[sub_status]==1">
                            <button class="btn btn-primary btn-xs" disabled>检测报告上传</button>
                            <else />
                        <a href="{:U('/admin/test/recordUpload')}?centreno={$one.centreno}" class="btn btn-primary btn-xs" >检测报告上传</a></if>
                        <if condition="$one[pdf_path]">
                            <a href="javascript:void(0);" class="btn btn-info btn-xs" name="{$one.pdf_path}" onclick="return Check(this);">报告预览</a>
                            <if condition="$one[sub_status]==0 or $one[sub_status]==1">
                                <button class="btn btn-success btn-xs" disabled>提交审核</button>
                                <else />
                                <a href="javascript:void(0);" class="btn btn-success btn-xs" onclick="doUpdate('{$one.centreno}')">提交审核</a></if></if>
                    </td>
                </tr>
            </volist>
            </tbody>
        </table>
        <div class=" pull-left"><i class="glyphicon glyphicon-star" style="color: red">代表合同有变更</i></div>
        <div class=" pull-right"><nav aria-label="Page navigation" id="pagination">{$pagination}</nav></div>
        <!-- main end-->

    </div>
</div>
</div>
<script type="text/javascript">
    function doUpdate(centreno) {
        if(!centreno) return false;
        var _options = {"flag":"error","text":"确定提交审核吗？","buttons":{"ok":{"action":function(){onUpdate(centreno);}},"cancel":{}}};
        doConfirmDialog(_options);
    }
    function onUpdate(centreno) {
        $.ajax({
            type:"post",
            url:"{:U('/admin/Test/doUpd')}",
            data:{"centreno":centreno},
            dataType:"json",
            success:function(ret){
                if(ret.msg=='succ'){
                    var _options = {"text":"提交成功！","action":function(){window.location.reload();}};
                    doAlertDialog(_options);
                }else{
                    var _options = {"text":"提交失败！"};
                    if(data.msg) _options.text = data.msg;
                    doAlertDialog(_options);
                }
            }
        });
    }
    function Check(path) {
        var url=path.name;
        if(!url) return false;//获取url
        if(url.indexOf("http")==-1){
            thisHost = location.hostname;
            var newurl='http://'+thisHost+url;
        }else{
            var newurl=url;
        }
        //alert(newurl);
        window.open(newurl);
    }
    </script>
<include file="Common:footer" />