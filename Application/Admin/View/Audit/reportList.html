<include file="Common:header" title="后台首页"/>
<div id="page-wrapper">
	<include file="Common:breadcrumb" />
	<div id="page-inner" class="container">
		<div class="search-form">
			<form class="form-inline" method="GET" action="">
				<div class="form-group">
					<label>中心编号：</label>
					<input type="text" class="form-control input-sm" name="keyword" />
				</div>
				<button type="submit" class="btn btn-primary btn-sm" >查询</button>
			</form>
		</div>
		<table class="table table-bordered table-striped table-hover">
			<thead>
			<th>中心编号</th>
			<th>委托单位</th>
			<th>样品名称</th>
			<th>检验依据</th>
			<th>检验项目</th>
			<th>修改原因</th>
			<th>申请时间</th>
			<th>操作</th>
			<th>状态</th>
			</thead>
			<tbody>
			<volist name="lists" id="one" key="i">
				<tr>
					<td>{$one.contractno}</td>
					<td>{$one.clientname}</td>
					<td>{$one.samplename}</td>
					<td>{$one.testcriteria}</td>
					<td>{$one.testitem}</td>
					<td>{$one.reason}</td>
					<td>{$one.create_time}</td>
					<td>
						<if condition="$one[status] eq 0">
							<button class="btn btn-success btn-xs" onclick="onUpdate({$one.id})" {$view}><i class="glyphicon glyphicon-ok-circle"></i>允许</button>
							<button class="btn btn-danger btn-xs" onclick="update({$one.id})" {$view}><i class="glyphicon glyphicon-remove-circle"></i>拒绝</button>
							<else />
						</if>
					</td>
					<td><if condition="$one[status] eq 0">
						<span>未处理</span>
						<elseif condition="$one[status] eq 1" />
						<span style="color: green">允许</span>
						<else />
						<span style="color: red">拒绝</span></if>
					</td>
				</tr>
			</volist>
			</tbody>
		</table>
		<div class=" pull-right"><nav aria-label="Page navigation" id="pagination">{$pagination}</nav></div>
	</div>
</div>
</div>

<script src="__PUBLIC__/static/js/jquery.form.js"></script>
<script type="text/javascript">
    function onUpdate(id){
        if(!id) return false;
        var _options = {"flag":"error","text":"将批准该申请","buttons":{"ok":{"action":function(){pass(id);}},"cancel":{}}};
        doConfirmDialog(_options);
    }
    function pass(id){
        id.onclick = function() {};
        $.ajax({
            type:"post",
            url:"{:U('/admin/audit/isAllow')}",
            data:{"id":id},
            dataType:"json",
            success:function(ret){
                if(ret.msg=='succ'){
                    var _options = {"text":"批准成功！","action":function(){window.location.reload();}};
                    doAlertDialog(_options);
                }else{
                    var _options = {"text":"Error！"};
                    if(data.msg) _options.text = data.msg;
                    doAlertDialog(_options);
                }
            }
        });
    }
    function update(id){
        if(!id) return false;
        var _options = {"flag":"error","text":"您确定拒绝该申请吗？:","buttons":{"ok":{"action":function(){notPass(id);}},"cancel":{}}};
        doConfirmDialog(_options);
    }
    function notPass(id){
        id.onclick = function() {};
        $.ajax({
            type:"post",
            url:"{:U('/admin/audit/notAllow')}",
            data:{"id":id},
            dataType:"json",
            success:function(ret){
                if(ret.msg=='succ'){
                    var _options = {"text":"操作成功！","action":function(){window.location.reload();}};
                    doAlertDialog(_options);
                }else{
                    var _options = {"text":"Error！"};
                    if(data.msg) _options.text = data.msg;
                    doAlertDialog(_options);
                }
            }
        });
    }
</script>
<include file="Common:footer" />