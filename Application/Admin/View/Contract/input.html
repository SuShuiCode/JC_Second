<include file="Common:header" title="后台首页"/>
<script>
$(function() {
    $("#Brecord").click(function() {
        $('#myModal').modal({
            keyboard: true,
        })
    });
});

function valid(num) {
	console.log(num)
	var input_id = "#" + num;
	var input_class = "." + num;
	if($(input_id)[0].checked) {
		$('#footer').append("<span class=" + num + ">" + $(input_id).val() + "&nbsp;&nbsp;&nbsp;</span>")
	} else {
		$(input_class).remove()
	}
}
</script>
<div id="page-wrapper">
	<include file="Common:breadcrumb" />
    <div id="page-inner" class="container">
      <form id="form2" name="form1" method="post" action="">
        <table class="table table-bordered table-striped table-hover">
          <tr>
            <td  colspan="9" ><p align="center" >委 托 人 填 写 </p></td>
            <input name="department" type="hidden"  id="department" value="{$department}" />  
          </tr> 
          <tr > 
            <td><p align="center" ><span style="color:red; font-size:15px">*</span>委托单位 </p></td>
            <td colspan="8" >
                <input name="clientName" type="text" class="form-control"  class="form-control" id="clientName2" size="100" />       
            </td>
          </tr> 
          <tr > 
            <td ><p align="center" ><span style="color:red; font-size:15px">*</span>生产单位 </p></td>
            <td colspan="8" ><input name="productUnit" type="text" class="form-control"  class="form-control"  id="productUnit2" size="100"/></td>
          </tr> 
          <tr > 
            <td ><p align="center" ><span style="color:red; font-size:15px">*</span>样品名称 </p></td>
            <td  colspan="2"><input name="sampleName" type="text" class="form-control"  id="sampleName2" size="20" /></td>
            <td  colspan="1"><p align="center" >样品编号 </p></td>
            <td  colspan="2"><input name="sampleCode" type="text" class="form-control"  id="sampleCode2" size="20" /></td>
            <td><p align="center" >等级 </p></td>
            <td colspan="2"><input type="text" class="form-control"  name="grade" id="grade2" size="5"/></td>
          </tr>
          <tr >
            <td  ><p align="center" >规格型号 </p></td>
            <td  colspan="2"><input type="text" class="form-control"  name="specification" id="specification2" size="20"/></td>
            <td  colspan="1"><p align="center" >商标 </p></td>
            <td  colspan="5" ><input type="text" class="form-control"  name="trademark" id="trademark2" /></td>
          </tr>
          <tr >
            <td><p align="center" >生产日期/批号 </p></td>
            <td colspan="2"><!--<input type="text" readonly class="form-control f-datetime input-sm" name="productionDate"/>-->
           					<input type="text" class="form-control" name="productionDate"/>
            <td colspan="1"><p align="center" ><span style="color:red; font-size:15px">*</span>样品数量 </p></td>
            <td colspan="5" >
            	<div class="col-xs-4">
            		<input type="text" class="form-control"  name="sampleQuantity" id="sampleQuantity" size="5"/>
                </div>
              <!--<label>
                <select name="sampleunti" id="select" value="sampleunti" class="form-control">
                	<option value="kg">kg</option>
                    <option value="g">g</option>
                    <option value="L">L</option>
                    <option value="mL">mL</option>
                </select>
            </label>--></td>
          </tr>
          <tr >
            <td ><p align="center" ><span style="color:red; font-size:15px">*</span>样品状态 </p></td>
            <td colspan="2"><input type="text" class="form-control"  name="sampleStatus" id="sampleStatus2" /></td>
            <td colspan="1"><p align="center" >水粉（料）比 </p></td>
            <td colspan="5" ><input type="text" class="form-control"  name="ration" id="ration2" /></td>
          </tr>
          <tr >
            <td valign="center" ><p align="center" ><span style="color:red; font-size:15px">*</span>检验依据 </p></td>
            <td colspan="8" ><input type="text" class="form-control"  name="testCriteria" id="testCriteria2" size="100"/></td>
          </tr>
          <tr >
            <td valign="center" ><p align="center" ><span style="color:red; font-size:15px">*</span>检验项目 </p></td>
            <td colspan="8" ><p>
              <input name="testItem" type="text" class="form-control"  id="testItem" size="100"/>
            </p></td>
          </tr>
          <tr >
            <td valign="center" ><p align="center" ><span style="color:red; font-size:15px">*</span>检验类别 </p></td>
            <td colspan="8" ><p align="center" >
              <input type="radio" name="testCategory" id="testCategory10" value="委托检验" checked="checked"/>委托检验
              
              <input type="radio" name="testCategory" id="testCategory11" value="抽样检验" />抽样检验
              
              <input type="radio" name="testCategory" id="testCategory12" value="型式检验" />型式检验
            </p></td>
          </tr>
          <tr >
            <td valign="center" colspan="6" ><p >检验报告是否在本中心网站可查询真伪 ?（www.dmtc.org.cn） </p></td>
            <td valign="center" colspan="3" ><p >是
             <input type="hidden" name="ifOnline" value="1"/>
               <!--否
              <input type="radio" name="ifOnline" id="testCategory14" value="0" readonly="readonly" />-->
            </p></td>
          </tr>
          <tr >
            <td valign="center" ><p align="center" >报告提交方式 </p></td>
            <td valign="center" colspan="2"><p >自取
              <input type="radio" name="postMethod" id="testCategory15" value="自取" checked="checked"/>
              邮寄
              <input type="radio" name="postMethod" id="testCategory16" value="邮寄" />
            </p></td>
            <td colspan="3"><p align="center" >是否同意分包 </p></td>
            <td  colspan="2"><p >是
              <input type="radio" name="ifSubpackage" id="ifSubpackage" value="1"  checked="checked" onclick="pack_remark()" />
              否
              <input type="radio" name="ifSubpackage" id="ifSubpackage" value="0" onclick="pack_remark()"/>
            </p></td>
            <td  colspan="2"><p >
              <input type="text" name="package_remark" id="package_remark" value="" class="form-control" placeholder="分包备注" />
            </p></td>
          </tr>
          <tr >
            <td  ><p align="center" ><span style="color:red; font-size:15px">*</span>委托人(签字)</p></td>
            <td  colspan="2"><input name="clientSign" type="text" class="form-control"  id="clientSign2" size="3" /></td>
            <td  ><p align="center" >联系电话 </p></td>
            <td colspan="2" ><input type="text" class="form-control"  name="telephone" id="telephone2" size="8"/></td>
            <td  ><p align="center" >传真 </p></td>
            <td colspan="2" ><input type="text" class="form-control"  name="tax" id="tax2" size="11" /></td>
          </tr>
          		  <tr >
            <td  ><p align="center" >邮政编码 </p></td>
            <td  colspan="2"><input type="text" class="form-control"  name="postcode" id="postcode2" size="8"/></td>
            <td  ><p align="center" >E-mail </p></td>
            <td  colspan="5" ><input type="text" class="form-control"  name="email" id="email2" /></td>
          </tr>
          <tr >
            <td valign="center" ><p align="center" >通讯地址 </p></td>
            <td valign="center" colspan="8" ><input type="text" class="form-control"  name="address" id="address2" size="100"/></td>
          </tr>
          <tr >
            <td valign="center" ><p align="center" >备注 </p></td>
            <td valign="center" colspan="8" >
            <textarea class="form-control"  name="remark" id="remark"></textarea></td>
          </tr>
          <tr >
            <td   colspan="9" ><p align="center" >中 心 办 公 室 填 写 </p></td>
          </tr>
          <tr >
            <td valign="center" ><p align="center" ><span style="color:red; font-size:15px">*</span>样品状态及数量 </p></td>
            <td valign="center" colspan="3"><input type="text" class="form-control"  name="sampleStaQuan" id="sampleStaQuan2" size="20"/></td>
            <td valign="center" ><p align="center" ><span style="color:red; font-size:15px">*</span>收 样 人 </p></td>
            <td valign="center" colspan="4" ><input type="text" class="form-control" readonly name="collector" id="collector2" value="{$collector}"/></td>
          </tr>
          <tr >
            <td  ><p align="center" ><span style="color:red; font-size:15px">*</span>中心编号 </p></td>
            <td   colspan="3" ><p>
              <input type="text" class="form-control"  name="centreNo" id="centreNo" readonly="readonly" size="9"/>
              <!--<input type="button" name="button2" id="button2" value="生成中心编码" />-->
              <input name="ifHighQuantity" type="checkbox" value="0" onClick="upVIPCode()"/>
              前100号
              <div id="remainCode" style="display:none;color:red">
                当前剩余量：<span id="remain"></span>
              </div>
              <input type="checkbox" id="spec_checkbox" onclick="special_code()"/>申请咨询<br/>
              <!--<button class="btn btn-success" type="button" onclick="special_code()">申请特殊编码</button>-->
              <div>
              		<ul id="spe_code" style="display:none">
                    	
                    <ul>
              </div>
            </td>
            <td  ><p align="center" ><span style="color:red; font-size:15px">*</span>检验费用 </p></td>
            <td  colspan="4" >
              <div class="col-xs-6">
                  <p align="center">参考价格</p>
                  <input name="Arecord" type="text" class="form-control"  id="Arecord" size="5" placeholder="A部门" readonly   onClick="Cost('A')"/>
                  <br/>
                  <input name="Brecord" type="text" class="form-control"  id="Brecord" size="5" placeholder="B部门" readonly />
                  <br/>
                  <input name="Crecord" type="text" class="form-control"  id="Crecord" size="5" placeholder="C部门" readonly  onClick="Cost('C')"/>
                  <br/>
                  <input name="Drecord" type="text" class="form-control"  id="Drecord" size="5" placeholder="D部门" readonly  onClick="Cost('D')"/>
                  <br/>
                  <input name="Erecord" type="text" class="form-control"  id="Erecord" size="5" placeholder="E部门" readonly  onClick="Cost('E')"/>
                  <br/>
                  <input name="Frecord" type="text" class="form-control"  id="Frecord" size="5" placeholder="F部门" readonly  onClick="Cost('F')"/>
                  <br/>
                  <p align="center">备注</p>
                  <textarea class="form-control" rows="10" name="fee_remark"></textarea>
              </div>
              <div  class="col-xs-6">
                  <p align="center">报告应收价格</p>
                  <input name="RArecord" type="text" class="form-control two-col"  id="RArecord" size="5" placeholder="A部门" onKeyUp="computeSum()"/>&nbsp;&nbsp;&nbsp;<p class="hint">A部门</p>
                  <div>+</div>
                  <input name="RBrecord" type="text" class="form-control two-col"  id="RBrecord" size="5" placeholder="B部门" onKeyUp="computeSum()"/>&nbsp;&nbsp;&nbsp;<p class="hint">B部门</p>
                  <div>+</div>
                  <input name="RCrecord" type="text" class="form-control two-col"  id="RCrecord" size="5" placeholder="C部门" onKeyUp="computeSum()"/>&nbsp;&nbsp;&nbsp;<p class="hint">C部门</p>
                  <div>+</div>
                  <input name="RDrecord" type="text" class="form-control two-col"  id="RDrecord" size="5" placeholder="D部门" onKeyUp="computeSum()"/>&nbsp;&nbsp;&nbsp;<p class="hint">D部门</p>
                  <div>+</div>
                  <input name="RErecord" type="text" class="form-control two-col"  id="RErecord" size="5" placeholder="E部门" onKeyUp="computeSum()"/>&nbsp;&nbsp;&nbsp;<p class="hint">E部门</p>
                  <div>+</div>
                  <input name="RFrecord" type="text" class="form-control two-col"  id="RFrecord" size="5" placeholder="F部门" onKeyUp="computeSum()"/>&nbsp;&nbsp;&nbsp;<p class="hint">F部门</p>
                  <div>+</div>
                  <input name="Dcopy" type="text" class="form-control two-col"  id="Dcopy" placeholder="副本" onKeyUp="computeSum()" size="5" />&nbsp;&nbsp;&nbsp;<p class="hint">副本</p>
                  <div>+</div>
                  <input name="Donline" type="text" class="form-control two-col"  id="Donline" placeholder="上网费" onKeyUp="computeSum()" value="100" />&nbsp;&nbsp;&nbsp;<p class="hint">上网费</p>
                  <div>+</div>
                  <input name="Drevise" type="text" class="form-control two-col"  id="Drevise" placeholder="项目修改" onKeyUp="computeSum()" size="6" />&nbsp;&nbsp;&nbsp;<p class="hint">项目修改</p>
                  <div>+</div>
                  <input name="Dother" type="text" class="form-control two-col"  id="Dother" placeholder="其他"  onKeyUp="computeSum()"/>&nbsp;&nbsp;&nbsp;<p class="hint">其他</p>
                  <div>=</div>
                  <input name="testCost" type="text" class="form-control two-col"  id="sumCost" placeholder="总计"  value="100" readonly />
              </div>
            </td>
          </tr>
          <tr >
            <td  ><p align="center" ><span style="color:red; font-size:15px">*</span>收样日期 </p></td>
            <td  colspan="3" ><p >
            
            <div class="form-group">
				 <input type="text" readonly class="form-control" name="collectDate" id="collectDate" value=""/>
				  	</div>
            </p></td>
            <td valign="center" ><p align="center" ><span style="color:red; font-size:15px">*</span>报告日期<u> </u></p></td>
            <td  colspan="4" ><p ><input type="text" readonly class="form-control f-datetime input-sm" name="reportDate"></p></td>
          </tr>
          <tr >
            <td valign="center" ><p >说明 </p></td>
            <td  colspan="8" ><ol>
              <li>委托人应对所提供的资料、信息和样品的真实性负责。 </li>
              <li>若对本单内容有变动，请委托方电话、邮件、传真通知受理人。 </li>
              <li>本中心仅对来样负责。 </li>
              <li>委托方要求取走剩余样品时，若在收到检验报告后一个月内未取回，且没有说明情况的，剩余样品由中心统一处理；样品取走后不再受理异议申诉。 </li>
            </ol></td>
          </tr>
        </table>
        
       <!-- <button class="btn btn-success" type="button" id="sampling_list" on>生成抽样单</button>-->
        <button class="btn btn-success" type="submit" id="check_list" onClick="doInputContract()">保存</button>
      </form>
    </div>
    <div>
		<!-- 模态框（Modal） -->
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							&times;
						</button>
						<h4 class="modal-title" id="myModalLabel">
							费用管理
						</h4>
						<div class="col-sm-10 search">
							<input type="text" class="form-control col-sm-10 standard" placeholder="请输入标准号" id="criteria">
							<button class="btn btn-primary search_btn"  onclick="findCriteria()" >搜索</button>
						</div>
					</div>
					<div class="modal-body main_content sco">
						<!--折叠的大div，在一个大的id下折叠会相互影响，id与a标签的date-parent相关联-->
						<div class="panel-group" id="accordion222">
							<!--折叠一的面板，折叠一-->
							<div class="panel panel-default">
								<!--折叠一的头部-->
								<div class="panel-heading">
									<h4 class="panel-title">
                                        <a data-toggle="collapse" data-parent="#accordion222" href="#collapseOne">
                                            瓷墙地砖填缝剂JC/T1004-2006
                                        </a>
                                    </h4>
								</div>
								<!--折叠一的内容，id与a标签的href相关联-->
								<div id="collapseOne" class="panel-collapse collapse">
									<div class="panel-body">
										<!--折叠一的内容的大div，id与a标签的date-parent相关联-->
										<div class="panel-group" id="accordion">
											<!--折叠一的折叠一的头部-->
											<div class="panel panel-default">
												<div class="panel-heading">
													<h4 class="panel-title">
									                			<a data-toggle="collapse" data-parent="#accordion" href="#collapseOne_A">
									                				水泥基陶瓷墙地砖填缝剂
									                			</a>
			            									</h4>
												</div>
												<!--折叠一的折叠一的内容，id与a标签的href相关联-->
												<div id="collapseOne_A" class="panel-collapse collapse">
													<div class="panel-body">
														<form class="checkbox-inlin" role="form">
															<input type="checkbox" id="inlineCheckbox1" value="耐磨损性/800（元）" onchange="valid(this.id)"> 耐磨损性
															<input type="checkbox" id="inlineCheckbox2" value="收缩值/500（元）" onchange="valid(this.id)"> 收缩值
															<input type="checkbox" id="inlineCheckbox3" value="标准抗折强度/300（元）" onchange="valid(this.id)"> 标准抗折强度
															<input type="checkbox" id="inlineCheckbox4" value="标准抗压强度/300（元）" onchange="valid(this.id)"> 标准抗压强度
															<input type="checkbox" id="inlineCheckbox5" value="冻融循环抗折强度/600（元）" onchange="valid(this.id)"> 冻融循环抗折强度
															<input type="checkbox" id="inlineCheckbox6" value="冻融循环抗压强度/600（元）" onchange="valid(this.id)"> 冻融循环抗压强度
															<input type="checkbox" id="inlineCheckbox7" value="吸水量(30min)/500（元）" onchange="valid(this.id)"> 吸水量(30min)
															<input type="checkbox" id="inlineCheckbox8" value="吸水量(240min)/500（元）" onchange="valid(this.id)"> 吸水量(240min)
															<input type="checkbox" id="inlineCheckbox9" value="标准试验条件24h抗压强度/200（元）" onchange="valid(this.id)"> 标准试验条件24h抗压强度
															<input type="checkbox" id="inlineCheckbox10" value="横向变形/300（元）" onchange="valid(this.id)"> 横向变形
															<input type="checkbox" id="inlineCheckbox11" value="高耐磨性/200（元）" onchange="valid(this.id)"> 高耐磨性
															<input type="checkbox" id="inlineCheckbox12" value="30min低吸水量/300（元）" onchange="valid(this.id)"> 30min低吸水量
															<input type="checkbox" id="inlineCheckbox13" value="240min低吸水量/300（元）" onchange="valid(this.id)"> 240min低吸水量
														</form>
													</div>
												</div>
											</div>
											<div class="panel panel-default">
												<div class="panel-heading">
													<h4 class="panel-title">
								                				<a data-toggle="collapse" data-parent="#accordion" href="#collapseOne_B">
								                					点击我再次展开第一部分的子部分
								                				</a>
		            										</h4>
												</div>
												<div id="collapseOne_B" class="panel-collapse collapse">
													<div class="panel-body">
														Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident. Ad vegan excepteur butcher vice lomo.
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!--折叠二-->
							<div class="panel panel-default">
								<div class="panel-heading">
									<h4 class="panel-title">
                                        <a data-toggle="collapse" data-parent="#accordion222" href="#collapseTwo">
                                            混凝土地面用水泥基耐磨材料JC/T906-2002
                                        </a>
                                    </h4>
								</div>
								<div id="collapseTwo" class="panel-collapse collapse">
									<div class="panel-body">
										Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident. Ad vegan excepteur butcher vice lomo.
									</div>
								</div>
							</div>
							<!--折叠三-->
							<div class="panel panel-default">
								<div class="panel-heading">
									<h4 class="panel-title">
                                        <a data-toggle="collapse" data-parent="#accordion222" href="#collapseThree">
                                            预拌砂浆GB/T 25181-2010 、建筑砂浆基本性能试验方法标准JGJ/T70-2009
                                        </a>
                                    </h4>
								</div>
								<div id="collapseThree" class="panel-collapse collapse">
									<div class="panel-body">
										Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident. Ad vegan excepteur butcher vice lomo.
									</div>
								</div>
							</div>										
						</div>
					</div>
					<div class="modal-footer">
						<div class="select_opion" id="footer">

						</div>
						<p class="fis">总金额：<span></span></p>
						<button type="button" class="btn btn-default" data-dismiss="modal">
							关闭
						</button>
						<button type="button" class="btn btn-primary">
							提交更改
						</button>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal -->
		</div>
    </div>
</div>

<script src="__PUBLIC__/static/js/jquery.form.js"></script>
<script type="text/javascript">
		//生成中心编码
		makeCentreCode();
		$("input[name = 'testCategory']").change(function(){
			makeCentreCode();
		});
		

		
		//时间
		$(document).ready(function(){
			$('.f-datetime').datetimepicker({language:  'zh-CN',format:'yyyy-mm-dd',startView: 2,minView:2,	autoclose:true });
					//计算费用
			var date = new Date();	
			var years = date.getFullYear();
			var month = add_zero(date.getMonth()+1);
			var day = add_zero(date.getDate());
			var now_date = years+"-"+month+"-"+day;
			$("#collectDate").val(now_date);
			
		});	
		
		//补零
		function add_zero(temp){
			if(temp<10) return "0"+temp;
			else return temp;
		}
		
		function makeCentreCode(){
			var nowDate = new Date();
			var year = nowDate.getFullYear();
			var month = nowDate.getMonth()+1;
			month = month<10?'0'+month:month;
			var department = $('#department').val()==''?'D':$('#department').val();
			var type = $('input:radio[name="testCategory"]:checked').val();
			type = (type == '委托检验')?'W':'C';
			var code= '101';
			//获取最新编码
			$.ajax({
				url: "{:U('/admin/contract/getLastCode')}",
				dataType: 'json',			
				data:{"year":year,"month":month},
				async: false,
				success: function (res) {
					//var _options = {"text":"aaa！"};
					//_options.text = data.re;
					//doAlertDialog(_options);
					if(res.re!='none'){
						code = res.re;
						code = parseInt(code.substring(8,11))+1;
					}
				}
			});
			
			var centreCode = year+""+month+department+type+code;
			$('input[name="centreNo"]').val(centreCode);
			if(type=='W'){
				$("#sampling_list").css("display","none");
			}else{	
				$("#sampling_list").css("display","inline-block");
			}
		}
		
		function upVIPCode(){
			if($("input[name='ifHighQuantity']").is(':checked')){
				$("#spec_checkbox").attr("disabled","disabled");
				var nowDate = new Date();
				var year = nowDate.getFullYear();
				var month = nowDate.getMonth()+1;
				month = month<10?'0'+month:month;
				var department = $('#department').val()==''?'D':$('#department').val();
				var type = $('input:radio[name="testCategory"]:checked').val();
				type = (type == '委托检验')?'W':'C';
				var code='001';
				var remain;//剩余优质编号
				$.ajax({
					url:"{:U('/admin/contract/getHighCode')}",
					dataType:"json",
					data:{"year":year,"month":month},
					async:false,
					success:function(res){
						if(res.re!='none'){
							code = res.re;
							code = parseInt(code.substring(8,11))+1;
							//保持后面编码为三位数，不够补零
							code = (Array(3).join('0') + code).slice(-3);
						}
					}
				});
							
				var centreCode = year+""+month+department+type+code;
				remain = 100-code+1;
				$('input[name="centreNo"]').val(centreCode);
				$('input[name="ifHighQuantity"]').val(1);
				$("#remain").html(remain+"(含当前编号)");
				$("#remainCode").css("display","block");
			}else{
				$("#spec_checkbox").removeAttr("disabled");
				makeCentreCode();
				$('input[name="ifHighQuantity"]').val(0);
				$("#remainCode").css("display","none");
				
			}
		}
				
		//实时计算总费用
		function computeSum(){
			var sum =0 ;
			if($("#RArecord").val()!="" && $.trim($("#RArecord").val()).length>0){
				sum+=parseInt($("#RArecord").val());
			}
			if($("#RBrecord").val()!="" && $.trim($("#RBrecord").val()).length>0){
				sum+=parseInt($("#RBrecord").val());
			}
			if($("#RCrecord").val()!="" && $.trim($("#RCrecord").val()).length>0){
				sum+=parseInt($("#RCrecord").val());
			}		
			if($("#RDrecord").val()!="" && $.trim($("#RDrecord").val()).length>0){
				sum+=parseInt($("#RDrecord").val());
			}
			if($("#RErecord").val()!="" && $.trim($("#RErecord").val()).length>0){
				sum+=parseInt($("#RErecord").val());
			}
			if($("#RFrecord").val()!="" && $.trim($("#RFrecord").val()).length>0){
				sum+=parseInt($("#RFrecord").val());
			}
			if($("#Dcopy").val()!="" && $.trim($("#Dcopy").val()).length>0){
				sum+=parseInt($("#Dcopy").val());
			}
			if($("#Donline").val()!="" && $.trim($("#Donline").val()).length>0){
				sum+=parseInt($("#Donline").val());
			}
			if($("#Drevise").val()!="" && $.trim($("#Drevise").val()).length>0){
				sum+=parseInt($("#Drevise").val());
			}
			if($("#Dother").val()!="" && $.trim($("#Dother").val()).length>0){
				sum+=parseInt($("#Dother").val());
			}
			$("#sumCost").val(sum);
		}
		
		//合同入库
		function doInputContract(){
			//alert('start');
			//查找是否是特殊编码
			//if(confirm('若是委托检验提交后不可更改，确认提交吗？')){
				if($("#spec_checkbox").is(":checked")){
					ifspecial=1;	
				}else{
					ifspecial=0;	
				}
				var options = {
					url: "{:U('/admin/contract/doAddContract')}",
					dataType: 'json',
					data:{'ifspecial':ifspecial},
					beforeSubmit: function(){
						return true;
					},
					success: function (data) {
						if(data.msg=='succ'){
							var _options = {"text":"录入成功！","action":function(){window.location.reload();}};
							doAlertDialog(_options);
						}else{
							var _options = {"text":"录入失败！"};
							if(data.msg) _options.text = data.msg;
							doAlertDialog(_options);
						}
					}
				};
				$("#form2").ajaxForm(options);
				return false;
			//}
			//return false;
		}
		
		
		//特殊编码
		function special_code(){
			$("#spe_code").attr("display","block");
			if($("#spec_checkbox").is(":checked")){
				$.ajax({
					url:"{:U('/admin/contract/findSpecialCode')}",
					dataType:'json',
					success: function (re) {
						data = re.codeList;;
						num = re.numList;
						html="";
						for(var i =0;i<data.length;i++){
							if(num[i]>0)
							html+="<button  type='button' id='spec_li_"+i+"' class='btn btn-default btn-xs' onclick=choseSpe('"+i+"')><span id='code'>"+data[i]+"</span> 剩余量：<span id='remain_code'>"+num[i]+"</span>(含当前)</button><br/>";
							
						}
						$("#spe_code").html(html);
					}	
				});
				
				$("#spe_code").css("display","block");
				$("input[name=ifHighQuantity]").attr("disabled","disabled");
			}else{
				$("#spe_code").css("display","none");
				$("input[name=ifHighQuantity]").removeAttr("disabled");
				makeCentreCode();
			}
		}
		
		
		
		//选择特殊编码
		function choseSpe(id){
			var code = $("#spec_li_"+id+" #code").html();
			var remain_code = $("#spec_li_"+id+" #remain_code").html();
			$("#centreNo").val(code);
		}
		
		//分包备注是否显示
		function pack_remark(){
			if($("input:radio[name='ifSubpackage']:checked").val()==1){
				$("#package_remark").attr('type','text');	
			}else{
				$("#package_remark").val("");
				$("#package_remark").attr('type','hidden');	
			}
		}
		
		
		<!----------------------------------- start------------------------------------->
				
		//本部门费用选
		function Cost(de){
			var modal = $("#editModal_"+de);
			setMetOption(de);
			modal.modal();

		}
		
/*		//获取费用选项(下面三个函数)
		function setMetOption(de){
			//alert($('#meterial_'+de+' option').size());
			$.ajax({
				url: "{:U('/admin/contract/findMetList')}",
				dataType: 'json',
				beforeSubmit: function(){
					return true;
				},
				success: function (re) {
					$('#meterial_'+de).find("option").remove();
					var option = "<option value=0>请选择</option>";
					$('#meterial_'+de).append(option);
					
					data = re['meterial_list'];
					for(var i=0;i<data.length;i++){
						var meterial = data[i]['meterial'];
						option = "<option value='"+meterial+"'>"+meterial+"</option>";
						$('#meterial_'+de).append(option);
					}
				}	
			});
		}
		
		function setProOption(de){
			m_select = $("#meterial_"+de).val();
			$("#items_"+de).empty();
			$("#fee_"+de).empty();
			if(m_select!=0){
				$.ajax({
					url: "{:U('/admin/contract/findProList')}",
					dataType: 'json',
					data:{'m_select':m_select},
					beforeSubmit: function(){
						return true;
					},
					success: function (re) {
						$('#productname_'+de).find("option").remove();
						var option = "<option value=0>请选择</option>";
						$('#productname_'+de).append(option);
						data = re['productname_list'];
						for(var i=0;i<data.length;i++){
							var productname = data[i]['productname'];
							var criteria = data[i]['criteria'];
							option = "<option value='"+productname+","+criteria+"'>"+productname+" "+criteria+"</option>";
							$('#productname_'+de).append(option);
						}
					}	
				});
			}else{
				$('#productname_'+de).find("option").remove();
				var option = "<option value=0>请选择</option>";
				$('#productname_'+de).append(option);
			}
		}

		function setItemOption(de){
			m_select = $("#meterial_"+de).val();
			p_select = $("#productname_"+de).val();
			if(m_select!=0){
				$.ajax({
					url: "{:U('/admin/contract/findItemList')}",
					dataType: 'json',
					data:{'m_select':m_select,'p_select':p_select},
					beforeSubmit: function(){
						return true;
					},
					success: function (re) {
						$("#items_"+de).empty();
						$("#fee_"+de).empty();
						data = re['item_list'];
						for(var i=0;i<data.length;i++){
							var items = data[i]['item'];
							var money = data[i]['fee'];
							var quantity = data[i]['quantity'];
							if(quantity==2){
								option = "<input type='checkbox' id='items_all_"+de+"' name='items_all_"+de+"' value='"+money+"' onclick=checkAllFee('"+de+"'); />&nbsp;&nbsp;"+items+"&nbsp;&nbsp;";
								$('#items_'+de).prepend(option);
							}else if(quantity==0){
								option = "<input type='checkbox' name='s_items_"+de+"' value='"+money+"' onclick=checkFee('"+de+"');  />&nbsp;&nbsp;<span style='color:red; font-size:16px'>*</span>"+items+"&nbsp;&nbsp;";
								$('#items_'+de).append(option);
							}else{
								option = "<input type='checkbox' name='items_"+de+"' value='"+money+"' onclick=checkFee('"+de+"');  />&nbsp;&nbsp;"+items+"&nbsp;&nbsp;";
								$('#items_'+de).append(option);
							}
							
						}
					}	
				});
			}
		}
*/	

		//查询标准号
		function findCriteria(){
			var criteria = $("#criteria").val();
			$.ajax({
				url: "{:U('/admin/contract/findCriteria')}",
				dataType: 'json',
				data:{'criteria':criteria},
				beforeSubmit: function(){
					return true;
				},
				success: function (re) {
					var html_list="";		
					data_criteria = re['criteria_list'];
					data_productname = re['productname_list'];
					for(var i = 0;i<data_criteria.length;i++){
						var html_productname = "";
						for(var j=0;j<data_productname[i].length;j++){
							data_productname[i][j]['productname'];
							html_productname += '<div class="panel panel-default"><div class="panel-heading"><h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion_'+i+'" href="#collapseOne_'+i+j+'">'+data_productname[i][j]['productname']+'</a></h4></div></div>';
							
						}
						html_list += '<div class="panel panel-default" id="fee_list_'+i+'"><div class="panel-heading"><h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion222" href="#collapseOne_'+i+'">'+data_criteria[i]['criteria']+'</a></h4></div><div id="collapseOne_'+i+'" class="panel-collapse collapse"><div class="panel-body"><div class="panel-group" id="accordion_'+i+'">'+html_productname+'</div></div></div></div>';
						$("#accordion222").html(html_list);

					}
				}	
			});

		}
		
		
				
		//计算本部门费用--单项选择
		function checkFee(de){
			cash = 0;
			var allCheck=true;
			$("input[name='items_"+de+"']").each(function(index, element) {
				if($(this).prop("checked") == false){
					allCheck = false;
				}else{
					cash+=parseInt(element.value);
				}		
			});
			if($("#items_all_"+de).length>0){
				if(allCheck==false){
					$("input[name='items_all_"+de+"']").prop("checked",false);	
				}else{
					$("#items_all_"+de).prop("checked",true);
					cash = parseInt($("#items_all_"+de).val());
				}
			}		
			$("input[name='s_items_"+de+"']").each(function(index, element) {
				if($(this).prop("checked") == true){
					cash+=parseInt(element.value);	
				}				
			});				
			$("#fee_"+de).html(cash);
		}
		//计算本部门费用--全项选择
		function checkAllFee(de){
			var cash=0;
			$("#items_all_"+de).prop("checked",$("#items_all_"+de).prop("checked"));
			if($("#items_all_"+de).prop("checked")){
				$("input[name=items_"+de+"]").prop("checked",true);
				cash = parseInt($("#items_all_"+de).val());
			}else{
				$("input[name=items_"+de+"]").prop("checked",false);
			}
			$("input[name='s_items_"+de+"']").each(function(index, element) {
				if($(this).prop("checked") == true){
					cash+=parseInt(element.value);	
				}				
			});
			$("#fee_"+de).html(cash);
		}
		
		function returnCost(de){
			$("#"+de+"record").val($("#fee_"+de).html());
			//computeSum();
		}

		<!-----------------------------------费用 end------------------------------------->
		
	</script>
</body>